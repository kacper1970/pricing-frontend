<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Oblicz cenę usługi</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
      background-color: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    select, input {
      padding: 0.5rem;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      margin-top: 0.5rem;
    }
    button {
      margin-top: 2rem;
      padding: 0.75rem;
      font-size: 1rem;
      width: 100%;
      cursor: pointer;
    }
    pre {
      background: #eaeaea;
      padding: 1rem;
      white-space: pre-wrap;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h1>Oblicz cenę usługi</h1>

  <form id="pricing-form">
    <label for="service">Usługa:</label>
    <select id="service" name="service" required>
      <option value="">-- Wybierz usługę --</option>
    </select>

    <label for="address">Adres realizacji:</label>
    <input type="text" id="address" name="address" required>

    <label for="vat">Stawka VAT:</label>
    <select id="vat" name="vat">
      <option value="8">8%</option>
      <option value="23">23%</option>
    </select>

    <label for="date">Data wizyty:</label>
    <input type="date" id="date" name="date" required>

    <label for="time">Godzina wizyty:</label>
    <input type="time" id="time" name="time" required>

    <label for="package">Pakiet:</label>
    <select id="package" name="package">
      <option value="safe">Safe</option>
      <option value="comfort">Comfort</option>
      <option value="priority">Priority</option>
      <option value="all">All Inclusive</option>
    </select>

    <label>
      <input type="checkbox" id="override" name="override">
      Wymuś wizytę natychmiastową
    </label>

    <button type="submit">Oblicz cenę</button>
  </form>

  <pre id="result"></pre>

  <script>
    const API_BASE = "https://pricing-service.onrender.com";

    // Ładowanie usług
    fetch(`${API_BASE}/pricing/services`)
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("service");
        data.services.forEach(service => {
          const opt = document.createElement("option");
          opt.value = service;
          opt.textContent = service;
          select.appendChild(opt);
        });
      })
      .catch(err => {
        alert("Nie udało się załadować listy usług");
        console.error(err);
      });

    // Obsługa formularza
    document.getElementById("pricing-form").addEventListener("submit", function(e) {
      e.preventDefault();

      const service = document.getElementById("service").value;
      const address = document.getElementById("address").value;
      const vat = document.getElementById("vat").value;
      const date = document.getElementById("date").value;
      const time = document.getElementById("time").value;
      const package = document.getElementById("package").value;
      const override = document.getElementById("override").checked;

      const query = new URLSearchParams({
        service,
        address,
        vat,
        date,
        time,
        package,
        override
      });

      fetch(`${API_BASE}/pricing/full?${query}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById("result").textContent = JSON.stringify(data, null, 2);
        })
        .catch(err => {
          document.getElementById("result").textContent = "Błąd: " + err;
        });
    });
  </script>
</body>
</html>
